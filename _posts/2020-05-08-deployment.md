---
layout: single
title:  "무중단 배포 방식"
date:   2020-05-08 09:50:59 +0900
classes: wide
categories: etc
tags: deployment
toc: true
toc_sticky: true
---

이 전에 TIL로 정리했던 부분을 블로그로 이동했습니다.

## Rolling 배포

Blue-Green 배포 방식과 비슷하다. 로드밸런서에 연결 되어 있던 기존 서버를 빼고, 서버를 업데이트 후에 다시 로드밸런서에 연결한다. 그리고 다음 서버를 또 업데이트한다. 순차적으로 업데이트를 진행하면 된다.

![Rolling](/assets/img/deployment/rolling.gif)

Blue-Green과 비슷하지만, 일제히 버전업이 되는 것이 아니라 순차적으로 버전이 올라가기 때문에 일부 사용자들은 낮은 버전, 일부 사용자들은 높은 버전을 겪을 수 있다. 또한 배포가 진행되는 중에는 인스턴스의 수가 줄어들기 때문에 트래픽에 대한 영향을 고려해봐야 한다.

## Blue-Green 배포

실제 서비스 중인 환경(Blue)에서 새롭게 배포할 환경(Green)으로 변경하는 방식으로 구현한다.

![Blue-Green](/assets/img/deployment/blue_green.gif)

문제가 발생했을 때 빠르게 롤백할 수 있고, 사용자들은 하나의 버전만 경험할 수 있기 때문에 버전관리 문제가 없다. 인스턴스의 수가 줄어들지는 않지만, 전체적으로 구동중인 서버의 수보다 두배만큼 서버가 더 필요하다.(위 그림에서 실제 구동 서버는 4대지만, 전체 필요한 서버는 8대인 것 처럼)

## 까나리 배포

소수의 유저만 사용하는 환경에 신규 버전을 배포하고 문제가 없다고 판단되었을 때 다른 모든 서버에 배포한다.

![Canary](/assets/img/deployment/canary.gif)

위와 같은 방식으로 한번에 업데이트 버전으로 올리는 방식도 있고, 순차적으로 일부 트래픽을 분배하면서 버전을 올릴 수도 있다.
